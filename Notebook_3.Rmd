---
title: "Notebook 3: Erosion and Suspended Sediments"
author: "your name"
date: "June 30, 2022"
output: html_notebook
---

# Fundamentals of Hydrology: Precipitation

Today, we are going to explore suspended sediment data. These data span several decades and are part of a Long Term Ecological Research Forest in Oregon. The [H.J.Andrews LTER](https://andrewsforest.oregonstate.edu/) is located in the Oregon Cascades. But before looking at these data, we need to load some packages that we installed in the previous session

```{r message=FALSE}
library(ggplot2)
library(dplyr)
library(lubridate)
library(scales)
```

```{r}
#Defining a common theme for our graphics
theme_fg = theme(axis.text=element_text(colour="black",size=14),
                 axis.title.y = element_text(size = 20),
                 axis.title.x = element_text(size = 20),
                 panel.grid.minor= element_line(colour = "gray", linetype = "dotted"), 
                 panel.grid.major = element_line(colour = "gray", linetype = "dashed"),
                 panel.border = element_rect(fill=NA, colour = "black", size=1),
                 panel.background=element_blank(),
                 axis.ticks.length = unit(0.254, "cm"),
                 axis.ticks = element_line(colour = "black", size=1), 
                 axis.line = element_line(colour = "black"),
                 legend.position = c(.90,.90),
                 legend.direction = "vertical",
                 legend.background = element_rect(fill=alpha(0.1)),
                 legend.title = element_blank())
```
 
We will use the same data set analyzed in the stream flow section.

```{r message = FALSE}
#Loading the data and making some internal arrangement
hjs <- read.csv("220621_fho_hjandrews.csv")
hjs$dt <- as.Date(hjs$dt, origin = "1899-12-30", format = "%Y-%m-%d")
hjs$ws.f <- factor(hjs$ws.f,levels = c("Old-growth","Logged"))
hjs$ssn <- factor(hjs$ssn,levels = c("Fall","Winter","Spring","Summer"))
```

In this dataset, Total Suspended Solids (TSS) is represented by the variable "sed.mg_l" in which mg_l is the concentration unit (miligrams per litter). Let's start with a quick look of the time series:

## Suspended sediments over time

```{r message = FALSE}
dat_tss_fig <- ggplot(hjs, aes(y=sed.mg_l, x= dt, color = ws.f, fill = ws.f))+
  geom_line(alpha=0.5)+
  # geom_point(alpha = 0.5)+
  geom_smooth(span = 0.35)+
  scale_x_date()+
  scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
    labels = trans_format("log10", math_format(10^.x)))+ #the function trans_breaks comes with the package scales
  xlab("Water year")+
  ylab(expression(paste("Suspended Sediments (mg",l^{-1}, ")")))+
  scale_color_manual(values = c("#00BFC4","#F8766D"))+
  scale_fill_manual(values = c("#00BFC4","#F8766D"))+
  facet_wrap(~ws.f)+
  theme_fg
dat_tss_fig
```
## Suspended sediment concentrations along the hydrological year (Oct 1 - Sept 30)

```{r}
day_tss_fig <- ggplot(hjs, aes(y=sed.mg_l, x= wd, color = ws.f, fill = ws.f))+
  geom_line(alpha=0.5)+
  # geom_point(alpha = 0.5)+
  geom_smooth(span = 0.35)+
  scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
    labels = trans_format("log10", math_format(10^.x)))+
  xlab("Water day")+
  ylab(expression(paste("Suspended Sediments (mg",l^{-1}, ")")))+
  scale_color_manual(values = c("#00BFC4","#F8766D"))+
  scale_fill_manual(values = c("#00BFC4","#F8766D"))+
  facet_wrap(~ws.f)+
  theme_fg
day_tss_fig
```

Let's now explore the data using histograms or density plots;

```{r}
hist_tss_fig <- ggplot(hjs, aes(x=sed.mg_l, color = ws.f, fill = ws.f))+
  # geom_histogram(alpha = 0.5)+
  geom_density(alpha = 0.5)+
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
    labels = trans_format("log10", math_format(10^.x)))+
  # ylab("Frequency")+
  ylab("Estimated kernel density")+
  xlab(expression(paste("Suspended Sediments (mg",l^{-1}, ")")))+
  scale_color_manual(values = c("#00BFC4","#F8766D"))+
  scale_fill_manual(values = c("#00BFC4","#F8766D"))+
  # facet_wrap(~ws.f)+
  theme_fg
hist_tss_fig
```

How about the seasonal changes in concentration of suspended sediments? 

```{r message=FALSE}
ssn_tss_fig <- ggplot(hjs, aes(x=sed.mg_l, color = ssn, fill = ssn))+
  # geom_histogram(alpha = 0.5)+
  geom_density(alpha = 0.5)+
  scale_x_log10()+
  ylab("Estimated kernel density")+
  xlab(expression(paste("Suspended Sediments (mg",l^{-1}, ")")))+
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
    labels = trans_format("log10", math_format(10^.x)))+
  facet_wrap(~ws.f)+
  theme_fg
ssn_tss_fig
```

Let's compare both watersheds season by season


```{r}
ssn_tss_fig <- ggplot(hjs, aes(x=sed.mg_l, color = ws.f, fill = ws.f))+
  # geom_histogram(alpha = 0.5)+
  geom_density(alpha = 0.5, size = 1.25)+
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
    labels = trans_format("log10", math_format(10^.x)))+
  ylab("Estimated Kernel Density")+
  xlab(expression(paste("Suspended Sediments (mg",l^{-1}, ")")))+
  scale_color_manual(values = c("#00BFC4","#F8766D"))+
  scale_fill_manual(values = c("#00BFC4","#F8766D"))+
  facet_wrap(~ssn)+
  theme_fg
ssn_tss_fig
```

